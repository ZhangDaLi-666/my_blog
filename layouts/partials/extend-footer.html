<!-- é¼ æ ‡ç‚¹å‡»çƒŸèŠ±ç‰¹æ•ˆ -->
<script src="https://cdn.jsdelivr.net/npm/mouse-firework@latest/dist/index.umd.js"></script>
<!-- é¼ æ ‡æ‹–å°¾æ•ˆæœ -->
<script src="https://unpkg.com/cursor-effects@latest/dist/browser.js"></script>
<!-- èƒŒæ™¯æ•ˆæœ -->
<div id="tsparticles"></div>
<script src="https://cdn.jsdelivr.net/npm/@tsparticles/preset-snow@3/tsparticles.preset.snow.bundle.min.js"></script>

<!-- è‡ªå®šä¹‰è“è‰²å…‰æ ‡æ ·å¼ -->
<style>
  * {
    cursor: none !important;
  }
  .custom-cursor {
    position: fixed;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(0, 200, 255, 0.8);
    box-shadow: 0 0 15px rgba(0, 200, 255, 0.8);
    pointer-events: none;
    transform: translate(-50%, -50%);
    transition: width 0.1s, height 0.1s, background 0.2s;
    z-index: 9999;
  }
</style>

<div class="custom-cursor"></div>

<script>
  // ç‚¹å‡»çƒŸèŠ±ç‰¹æ•ˆ
  firework({
    excludeElements: ["a"],
    particles: [
      {
        shape: "circle",
        move: "emit",
        easing: "easeOutExpo",
        colors: [
          "rgba(0,191,255,0.9)",
          "rgba(135,206,250,0.9)",
          "rgba(123,104,238,0.9)",
          "rgba(186,85,211,0.9)",
          "rgba(221,160,221,0.9)",
          "rgba(238,130,238,0.9)",
          "rgba(255,182,193,0.9)",
          "rgba(240,248,255,0.9)",

        ],
        number: 50,
        duration: [1200, 1800],
        shapeOptions: {
          radius: [5, 10],
        },
        moveOptions: {
          emitRadius: [50, 100],
        },
      },
    ],
  });

  // è‡ªå®šä¹‰è“è‰²å…‰æ ‡ç§»åŠ¨é€»è¾‘
  const cursor = document.querySelector(".custom-cursor");
  document.addEventListener("mousemove", (e) => {
    cursor.style.left = e.clientX + "px";
    cursor.style.top = e.clientY + "px";
  });
  //æ‹–å°¾
  new cursoreffects.fairyDustCursor({
    colors: ["#00aaff", "#ffffff", "#88ffff"],
    fairySymbol: ["â„"]
  });
  //èƒŒæ™¯ä¸‹é›ª
  (async () => {
    await loadSnowPreset(tsParticles);
    await tsParticles.load({
      id: "tsparticles",
      options: {
        preset: "snow",
        background:{
          color:"#000000",
          opacity:0
        }
      },
    });
  })();
</script>

<!-- è‡ªå®šä¹‰é¼ æ ‡å³é”®èœå• -->
<style>
  /* èœå•æ ·å¼ä¸æ·¡å…¥åŠ¨ç”» */
  .custom-context-menu {
    position: absolute;
    background: linear-gradient(180deg, rgba(40,40,40,0.95), rgba(24,24,24,0.95));
    color: #fff;
    border-radius: 10px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.45);
    padding: 6px 0;
    font-size: 14px;
    z-index: 10000; /* æ¯”èœå•ä½ä¸€ç‚¹ï¼Œç¡®ä¿å¯è§å…‰æ ‡åœ¨ä¸Š */
    pointer-events: auto;
    min-width: 180px;
    overflow: hidden;
    transform-origin: top left;
    animation: menuFadeIn 160ms ease;
  }

  @keyframes menuFadeIn {
    from { opacity: 0; transform: scale(0.96); }
    to   { opacity: 1; transform: scale(1); }
  }

  .custom-context-menu ul {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  .custom-context-menu li {
    padding: 10px 16px;
    cursor: pointer;
    transition: background 0.14s;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .custom-context-menu li:hover {
    background: rgba(255,255,255,0.04);
  }

  /* ç¡®ä¿è‡ªå®šä¹‰å…‰æ ‡åœ¨èœå•ä¹‹ä¸Šå¯è§ï¼ˆå…‰æ ‡å…ƒç´ ä¿ç•™ pointer-events:noneï¼‰ */
  .custom-cursor {
    z-index: 10001 !important;
  }
</style>

<script>
(function(){
  // è¾…åŠ©ï¼šç§»é™¤å·²æœ‰èœå•
  function removeMenu() {
    const old = document.querySelector('.custom-context-menu');
    if (old) old.remove();
  }

  // åœ¨å³é”®è§¦å‘æ—¶åˆ›å»ºèœå•
  document.addEventListener('contextmenu', function (event) {
    event.preventDefault();

    removeMenu();

    // å°è¯•è¯»å–è§†è§‰å…‰æ ‡ï¼ˆä½ çš„ .custom-cursorï¼‰
    const cursor = document.querySelector('.custom-cursor');
    // fallback ä½¿ç”¨ event.clientX/Y
    let cursorX = event.clientX;
    let cursorY = event.clientY;
    if (cursor) {
      const rect = cursor.getBoundingClientRect();
      // rect.left/top æ˜¯å…ƒç´ å®é™…ä½ç½®ï¼Œrect.width/height ç”¨äºå–ä¸­å¿ƒç‚¹
      cursorX = rect.left + rect.width / 2;
      cursorY = rect.top + rect.height / 2;
    }

    // åˆ›å»ºèœå• DOM
    const menu = document.createElement('div');
    menu.className = 'custom-context-menu';
    menu.innerHTML = `
      <ul>
        <li data-action="home">ğŸ  è¿”å›é¦–é¡µ</li>
        <li data-action="back">â¬…ï¸ è¿”å›ä¸Šä¸€é¡µ</li>
        <li data-action="copy">ğŸ”— å¤åˆ¶æœ¬é¡µé“¾æ¥</li>
        <li data-action="about">ğŸ’¡ å…³äºæœ¬ç«™</li>
      </ul>
    `;

    document.body.appendChild(menu);

    // å…ˆæ”¾åœ¨è§†å£å†…é¢„è®¡ä½ç½®ï¼Œç„¶åå¾®è°ƒé˜²æº¢å‡º
    // æˆ‘ä»¬å¸Œæœ›èœå•ä»å…‰æ ‡çš„ä¸‹æ–¹ç•¥å¾®åå³æ˜¾ç¤ºï¼ˆå…‰æ ‡ä¸Šæ–¹å¯è§ï¼‰
    const preferredOffsetX = 12; // æ°´å¹³åç§»ï¼ˆå‘å³ï¼‰
    const preferredOffsetY = 18; // å‚ç›´åç§»ï¼ˆå‘ä¸‹ï¼‰

    // éœ€è¦ç­‰å¾…æµè§ˆå™¨æ¸²æŸ“ä»¥è·å–èœå•å°ºå¯¸
    requestAnimationFrame(() => {
      const mRect = menu.getBoundingClientRect();
      let left = Math.round(cursorX + preferredOffsetX);
      let top  = Math.round(cursorY + preferredOffsetY);

      // å¦‚æœèœå•ä¼šè¶…å‡ºå³è¾¹ç•Œï¼Œæ”¹æ”¾åˆ°å·¦ä¾§
      if (left + mRect.width > window.innerWidth - 8) {
        left = Math.max(8, cursorX - mRect.width - preferredOffsetX);
      }
      // å¦‚æœèœå•ä¼šè¶…å‡ºåº•éƒ¨ï¼Œæ”¹æ”¾åˆ°ä¸Šæ–¹ï¼ˆä½†ä»ä¿ç•™å…‰æ ‡åœ¨ä¸Šï¼‰
      if (top + mRect.height > window.innerHeight - 8) {
        top = Math.max(8, cursorY - mRect.height - preferredOffsetY);
      }

      menu.style.left = left + 'px';
      menu.style.top  = top  + 'px';
    });

    // èœå•é¡¹äº‹ä»¶ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰
    menu.addEventListener('click', function (ev) {
      const li = ev.target.closest('li');
      if (!li) return;
      const action = li.getAttribute('data-action');
      removeMenu(); // ç‚¹å‡»åç§»é™¤

      if (action === 'home') {
        window.location.href = '/';
      } else if (action === 'back') {
        history.back();
      } else if (action === 'copy') {
        // å¤åˆ¶ï¼Œå¹¶æ˜¾ç¤ºç®€çŸ­æç¤º
        navigator.clipboard?.writeText(window.location.href)
          .then(() => {
            // ç®€æ˜“æç¤ºï¼ˆå¯æŒ‰éœ€æ›¿æ¢ä¸ºæ›´æ¼‚äº®çš„ toastï¼‰
            const tip = document.createElement('div');
            tip.textContent = 'å·²å¤åˆ¶é“¾æ¥';
            Object.assign(tip.style, {
              position: 'fixed',
              left: '50%',
              top: '24px',
              transform: 'translateX(-50%)',
              background: 'rgba(0,0,0,0.7)',
              color: '#fff',
              padding: '6px 12px',
              borderRadius: '6px',
              zIndex: 12000,
              fontSize: '13px'
            });
            document.body.appendChild(tip);
            setTimeout(()=> tip.remove(), 900);
          })
          .catch(()=> alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥'));
      } else if (action === 'about') {
        alert('å³é”®èœå•æ¥è‡ª Blowfish è‡ªå®šä¹‰ï¼');
      }
    });

    // ç‚¹å‡»å…¶ä»–åœ°æ–¹ã€æ»šåŠ¨æˆ–çª—å£å¤§å°å˜åŒ–æ—¶å…³é—­èœå•
    const closeHandler = () => removeMenu();
    document.addEventListener('click', closeHandler, { once: true });
    window.addEventListener('scroll', closeHandler, { once: true });
    window.addEventListener('resize', closeHandler, { once: true });
  });
})();
</script>

